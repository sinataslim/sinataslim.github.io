<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
    <script type="text/javascript" src=https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/geojson-extent/v1.0.0/geojson-extent.js'></script>
    <title>NYC Street Map</title>
    <style>
        #mapid { 
            height: 600px;
            width: 800px;
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <script>
        // create the canvas (like SVG)
        //var mymap = L.map('mapid').setView([40.75, -73.9], 11);

        //var token = "pk.eyJ1Ijoic2luYXRhc2xpbSIsImEiOiJja21zaWV6c2YwMDJtMnZsaTF1MXoyemlsIn0.pHwMxGbfNtPrQWbuyn8qBg"
        //L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png", {
        //    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        //    maxZoom: 18,
        //    //id: 'openstreet',
        //    //tileSize: 512,
        //    //zoomOffset: -1,
        //    //accessToken: token
        //}).addTo(mymap);
        
        // specify stamen tile layer
        var mapTileLayer = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg');

        // set the map centre, zoom and div-id
        var map = new L.Map("mapid", {
            center: new L.LatLng(40.73, -73.93),
            zoom: 10,
            maxZoom: 18, //set to avoid error
            minZoom: 9
        });
        map.addLayer(mapTileLayer)

        // NYC Boundary layer
        var NYCLayer = L.geoJSON().addTo(map)

        // read the NYC coordinates and add to the NYCLayer
        var nyc = d3.json("NYCboundaries.json")
        var SqGrid = d3.json("squareGrid.json")
        
        Promise.all([nyc, SqGrid]).then(ready)

        function ready(data) {
            
            var nycBoundary = data[0].features
            var squareGrid = data[1]
            
            // add NYC coordinates to NYCLayer
            NYCLayer.addData(nycBoundary)
            NYCLayer.setStyle({fillOpacity: 0.0})

            // extract NYC coords only
            var coordsNYC = nycBoundary[0].geometry.coordinates[0]
            
            // get the extent [minX, minY, maxX, maxY] of NYC coords
            var extent = [
            d3.min(coordsNYC, function(d) { return d[0]}),
            d3.min(coordsNYC, function(d) { return d[1]}),
            d3.max(coordsNYC, function(d) { return d[0]}),
            d3.max(coordsNYC, function(d) { return d[1]}),
            ]
            
            //// build the grid 
            //var bbox = extent
            //var cellSide = 0.2
            //var options = {
            //    units: 'kilometers',
            //    mask: turf.polygon([coordsNYC])
            //}
            //var squareGrid = turf.squareGrid(bbox, cellSide, options)
            //console.log(squareGrid)

            var grid

            function style (feature){
                return{
                    weight: .3,
                    color: "red",
                    fillOpacity: 0.0}
            }

            function highlightFeature(e) {
                var layer = e.target;

                layer.setStyle({
                    weight: 5,
                    color: 'yellow',
                    fillOpacity: 0.2
                });

                if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                    layer.bringToFront();
                }
            }

            function resetHighlight(e) {
                grid.resetStyle(e.target);
            }

            function onEachFeature(feature, layer) {
                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
                });
            }
            
            // add the grid to the map (add another layer)
            grid = L.geoJSON(squareGrid, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map)
            
            
            
            

            





            
            



        }
        







    </script>

    
    
</body>
</html>
